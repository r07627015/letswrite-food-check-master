<!DOCTYPE html>
<html>
<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">

	<title>äº¤å¤§ç¶“ç®¡åƒä»€éº¼ </title>


	<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css'/>
	<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'/>
	<link rel="stylesheet" href="assets/css/main.css">

</head>
<body>

	<!-- Google Tag Manager (noscript)-->
	<noscript>
		<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PGQ9WQT" height="0" width="0" style="display:none;visibility:hidden"></iframe>
	</noscript>

	<!--  èƒŒæ™¯åœ–  -->
	<main class="full-block">
		
		<!--  ä¸»è¦å…§å®¹  -->
		<div class="main-block">

			<!--  é¡¯ç¤ºå€å¡Š  -->
			<section class="god">
				<h1>
					<span class="wrap">
						<span>äº¤å¤§ç¶“ç®¡æ—é‚Šåƒä»€éº¼å‘¢ğŸ˜‹</span>
					</span>
				</h1>
			</section>

			<!--  æŒ‰éˆ•  -->
			<section class="btns">

									<!--  ç´ é£Ÿ  -->
				<!-- <div class="checkbox">
					<p class="vegetarian">Vegetarianï¼Ÿ</p>


					<div class="check">
						<label class="toggle">
							<input id="vage" type="checkbox" checked>
							<span class="button round"></span>
						</label>
					</div> 
				</div> -->

				<!--  start  -->
				<a class="btn-start" href="#">éš¨æ©Ÿä¾†ä¸€å®¶
					<span class="line top -h"></span>
					<span class="line right -v"></span>
					<span class="line bottom -h"></span>
					<span class="line left -v"></span>
				</a>
			</section>

			<!--  åœ°åœ–  -->
			<section id="map" class="map">
				<iframe loading="lazy" frameborder="0" style="border:0" src="" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
			</section>
		</div>
	</main>

	<!--  github link  -->
	<!-- <div class="github">
		<a href="https://github.com/letswritetw/letswrite-food-check">
			<i class="fa fa-github" aria-hidden="true"></i>
		</a>
	</div> -->

	<!--  for search  -->
	<div class="search-only">
		<h2>
			ä¸å¯èƒ½äº¤å¤§åˆ°å°åŒ—é‚„æ˜¯ç¾é£Ÿæ²™æ¼ å§?
		</h2>
		<p>
			Auther : Jason Wang
		</p>
	</div>
	

	<script>

		// Maps Embed APIã€Google Sheets API çš„ é‡‘é‘°
		// å¯ç”± https://console.developers.google.com/apis ç”³è«‹
		const embedApiKey = 'AIzaSyCoxBp3pyWcXoaM1KxStuvONrJwQme7kJY';

		const uri = 'https://sheets.googleapis.com/v4/spreadsheets/1I4vOYbHAsUvQgxEDGrTwR9rqGakGlbD72oLP5O9bg14/values/shop?alt=json&key=' + embedApiKey;

		const duration = 2000; // æ‹‰éœ¸æ•ˆæœåŸ·è¡Œå¤šä¹…

		fetch(uri)
			.then(res => res.json())
			.then(data => {
				let meats = []; // è‘·

				// å¡å…¥é™£åˆ—
				const d = data.values, len =  d.length;
				
				for(let i = 0; i < len; i++) {
					meats.push(d[i][0]);
				}
				

				// é»æ“ŠæŒ‰éˆ•å¾ŒåŸ·è¡Œ
				let r; // äº‚æ•¸
				let max, min; // é™£åˆ—çš„æœ€å¤§ã€å°å€¼
				let txt; // çµæœ


				// åœ°åœ–
				const map = document.querySelector('#map iframe');

				// æŒ‰éˆ•
				const btn = document.querySelector('.btn-start');
				
				btn.addEventListener('click', e => {
					e.preventDefault();

					// é¸åº—å®¶ fn
					const chooseShop = toggle => {

						// å–äº‚æ•¸ fn
						r = () => {
							max = toggle.length - 1;
							min = 0;
							return Math.floor(Math.random() * (max - min + 1)) + min;
						};

						// æ¸…ç©ºã€æ’å…¥é¸é …
						let input = document.querySelector('.wrap');
						input.innerHTML = '';
						for(let i = 0; i < toggle.length; i++) {
							input.insertAdjacentHTML('beforeend', '<span>' + toggle[i] + '</span>');
						}

						// ç¦æ­¢æŒ‰éˆ•å†è¢«é»æ“Š
						e.target.classList.add('not-allow');

						// åŠ å…¥å‹•ç•« class name
						const list = document.querySelectorAll('.wrap > span');
						Array.prototype.forEach.call(list, l => l.classList.add('span-' + (toggle.length - 1)));

						// äº‚æ•¸æ±ºå®šä¸­é¸åº—å®¶
						txt = toggle[r()];
						list[0].innerText = txt;
						
						// ç§»é™¤å‹•ç•«
						setTimeout(() => {
							// åœæ­¢æ‹‰éœ¸å‹•ç•«
							Array.prototype.forEach.call(list, l => l.removeAttribute('class'));

							// æ”¹è®Šåœ°åœ–ä½ç½®
							map.src = 'https://www.google.com/maps/embed/v1/place?key=' + embedApiKey + '&q=' + txt;

						}, duration);

						// é¡¯ç¤ºåœ°åœ–
						map.addEventListener('load', () => {
							map.classList.remove('hidden');
							e.target.classList.remove('not-allow');
						}, false);
					};



					// åœ°åœ–å…ˆæ¶ˆå¤±
					map.classList.add('hidden');

					// åˆ¤æ–·è‘·ç´ å¾Œï¼Œé–‹å§‹åŸ·è¡Œ
					chooseShop(meats);

				}, false);

			})
	</script>
</body>
</html>
